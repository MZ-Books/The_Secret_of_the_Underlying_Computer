# 메모리풀

메모리풀은 한 번에 큰 메모리 조각을 요청하고 그 위에서 자체적으로 메모리 할당과 해제를 관리하는 방식으로 표준 라이브러리와 운영 체제를 우회합니다.

|      | 메모리 풀                                  | malloc                    |
| ---- | ------------------------------------------ | ------------------------- |
| 정의 | 특정 상황을 위한 자체적인 메모리 할당 전략 | 범용적인 메모리 할당 전략 |
| 계층 | 응용 프로그램                              | 표준 라이브러리           |
| 대상 | 범용성이 떨어짐                            | 범용적→설계 복잡          |

### 메모리풀 구현하기

간단한 메모리풀이라면 큰 덩어리의 메모리를 할당받고 그 안에서 객체를 생성하고 반환하는 방식으로 사용할 수 있습니다.

하지만, 여러 크기의 메모리를 할당하려면 연결리스트로 메모리 조각을 관리해야 합니다.

요청 시마다 이전 메모리의 두 배를 할당해 빈번히 요청하지 않게 최적화합니다.

메모리풀은 한 번에 전체 메모리 조각을 해제해 비용 부담을 줄입니다.

### 메모리 풀의 스레드 안전 문제

메모리 풀은 단일 스레드에서 문제가 없으나 다중 스레드 환경에서는 스레드 안전을 보장할 수 없습니다

1. 메모리 풀에 잠금 보호 적용 → 경쟁이 치열해져 성능 저하 발생 가능
2. 스레드 전용 저장소 사용하여 각 스레드마다 메모리 풀 유지

### QnA

- **Q.** 스레드 전용 저장소를 사용해 메모리풀을 구현할 때
  스레드 A가 메모리 조각을 요청했지만, 그 수명 주기가 스레드 A 자체를 넘어서는 상황이라면 어떻게 해야 할까요?
  즉, 스레드 A의 실행이 완료된 후에도 다른 스레드에서 해당 메모리를 계속 사용해야 한다면, 해당 메모리는 스레드 A에 속해있음에도 스레드 B에서 이를 해제해야 합니다.
  이를 어떻게 해결할 수 있을까요?

  **A.** 중앙 집중형 메모리 관리자 사용
  모든 스레드가 공유할 수 있는 중앙 집중형 메모리 관리자를 도입할 수 있습니다. 이 관리자는 메모리 할당과 해제를 책임지며, 각 스레드는 이 관리자에게 메모리 요청을 합니다. 이렇게 하면 **메모리 조각의 소유권 문제를** 해결할 수 있습니다.
