# 스레드
프로세스를 통해 병렬적으로 프로그램을 실행하여 실행 시간을 줄일 수 있었습니다. 하지만 프로세스는 아래와 같은 단점을 갖고 있습니다. 

1. 프로세스를 생성하는 비용은 상당히 큽니다.
2. 프로세스마다 자제적인 주소공간을 갖고 있어 프로세스 간 통신은 프로그래밍하기 복잡합니다.

이러한 단점을 갖는 이유는 프로세스는 진입 함수가 main 함수 하나밖에 없기 때문에 프로세스의 기계 명령어를 한 번에 하나의 CPU에서만 실행할 수 있기 때문입니다. 따라서, CPU 여러 개가 동일한 프로세스의 기계 명령어를 실행하게 한다면 프로세스의 단점을 해결할 수 있습니다. 

PC 레지스터가 main 함수를 가리키게 할 수 있듯이 어떤 다른 함수라도 가리키게 할 수 있다면 새로운 실행 흐름을 만들 수 있습니다. 하나의 프로세스에서 여러 실행 흐름을 가질 수 있게 만든 것을 `스레드`라고 합니다.

스레드는 프로세스내에서 독립된 스택 영역, 프로그램 카운터, 레지스터를 가지고 있어 독립된 실행 흐름 또한 가질 수 있습니다. 

## 스레드의 장점
스레드는 하나의 프로세스 공간에 있기 때문에 더 이상 프로세스 간 통신이 필요하지 않습니다. 
운영 체제 계층에서 구현되기 때문에 단일 코어인 상황에서도 스레드 여러 개를 생성할 수 있습니다. 
이벤트 기반 프로그래밍을 할 때, 이벤트를 처리하는 별도의 스레드를 만들어 독립적인 실행흐름으로 프로그래밍할 수 있습니다. 

## 스레드의 단점
하나의 요청을 받았을 때 하나의 스레드를 생성하는 것을 `요청당 스레드(thread-per-request)`라고 합니다.

이때, 작업 시간이 길다면 요청당 스레드가 적절하지만 작업시간이 짧다면 스레드의 관리 비용을 감당해야 하기 때문에 적절하지 않습니다. 이럴 때에는 `스레드 풀`을 사용하는 것이 옳습니다. 

## 스레드 풀
스레드 풀은 스레드 여러 개를 미리 생성해두고, 스레드가 처리할 작업이 생기면 해당 스레드에 처리를 넘기는 것을 말합니다. 스레드를 재사용하기 때문에 생성과 소멸 비용이 줄고, 적은 리소스를 사용합니다. 9

두 타입의 스레드를 만들어 관리합니다. 작업을 전달하는 생산자(producer)와 작업을 처리하는 소비자(consumer)를 만들고, Producer 스레드가 작업 대기열 큐에 데이터를 enqueue하면 consumer가 받아서 작업을 처리합니다. 


